var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},Item=function(){function t(t){this.valueBuy=1e3,this.valueSell=1e3}return t.prototype.use=function(t){throw new Error("not implemented")},t.prototype.unuse=function(t){throw new Error("not implemented")},t.prototype.dispose=function(){},t.prototype.getTypeIconUrl=function(){return this.texUrl&&""!=this.texUrl||(this.texUrl=IconGenerator.getIconUrl(this.tySub)),this.texUrl},t.parse=function(e){var i=JSON.parse(e,function(t,e){return"tyMain"==t?ItemType[e]:"tySub"==t?ItemType[e]:e});return new t(i)},t}();__reflect(Item.prototype,"Item");var IronArmor=function(t){function e(){var e=t.call(this,null)||this;return e.name="铁盔甲",e.descript="铁制护甲，能防御住威力较低的攻击",e.tyMain=ItemType.ARMOR,e.tySub=ItemType.ARMOR,e}return __extends(e,t),e}(Item);__reflect(IronArmor.prototype,"IronArmor");var BagObj=function(){function t(t,e){this.item=t,this.num=e,this.name=t.name,this.tex=t.getTypeIconUrl(),this.discardable=t.tyMain!=ItemType.SPECIAL,this.useable=t.tyMain==ItemType.NORMAL}return t.prototype.use=function(){this.num--},t.prototype.discard=function(t){return void 0===t&&(t=1),this.discardable?t>this.num?(this.num=0,!0):(this.num-=t,!0):(console.log("Special items can not be discarded."),!1)},t}();__reflect(BagObj.prototype,"BagObj");var IconGenerator=function(){function t(){}return t.dispose=function(){for(var e in t.dic)RES.destroyRes(e);t.dic={}},t.getIconTexture=function(e){if(t.dic[e])return t.dic[e];try{var i=RES.getRes(e);return t.dic[e]=i,i}catch(n){return console.log("IconGenerator getIconTexture Error: ",n),null}},t.getIconUrl=function(t){var e="";switch(t){case ItemType.ALL:e="all";break;case ItemType.NORMAL:e="normal";break;case ItemType.WEAPON:e="weapon";break;case ItemType.ARMOR:e="armor";break;case ItemType.ACCESSORY:e="accessory";break;case ItemType.LOOT:e="loot";break;case ItemType.SPECIAL:e="special";break;case ItemType.RECOVER:e="recoveritem";break;case ItemType.BATTLE:e="battle";break;case ItemType.SWORD:e="sword";break;case ItemType.CLAYMORE:e="claymore";break;case ItemType.SPEAR:e="spear";break;case ItemType.BOW:e="bow";break;case ItemType.ROD:e="rod";break;case ItemType.HELMET:e="helmet";break;case ItemType.ARMOR2:e="armor2";break;case ItemType.MINE:e="mine";break;case ItemType.PLANT:e="plant";break;case ItemType.BONE:e="bones";break;case ItemType.KEY:e="keys";break;case ItemType.RECIPE:e="recipe";break;case ItemType.RING:e="ring";break;default:throw new Error("wrong item type")}return e="icon_item_main_json#"+e},t.dic={},t}();__reflect(IconGenerator.prototype,"IconGenerator");var ItemDetail=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/eui_skins/itemdetail.exml",e}return __extends(e,t),e.prototype.setItem=function(t){if(this.visible=null!=t,null!=t){var e=t.item;e.detailTexUrl&&""!=e.detailTexUrl?(this.containerIcon.visible=!0,this.containerIcon.percentWidth=25,this.containerDetail.percentWidth=75):(this.containerIcon.visible=!1,this.containerIcon.percentWidth=0,this.containerDetail.percentWidth=100),this.txtDetail.text=e.descript,this.txtNum.text="x"+t.num}},e}(eui.Component);__reflect(ItemDetail.prototype,"ItemDetail");var ItemList=function(t){function e(e){var i=t.call(this)||this;return i._itemHeight=-1,i.touchEnabled=!0,i._ty=e,i.addEventListener(eui.UIEvent.COMPLETE,i.onComplete,i),i.skinName="resource/eui_skins/itemlist.exml",i}return __extends(e,t),e.prototype.setData=function(t){return this.rawdata=t,this.refreshList(),this.itemListContainer.selectedItem},e.prototype.selectItem=function(t){var e=this.itemListContainer,i=e.selectedIndex+t;if(-1>=i)return null;if(i>=this.collectdata.length)return null;if(-1==this._itemHeight){var n=e.getChildAt(0);n&&(this._itemHeight=n.height)}e.selectedIndex=i;var r=e.numChildren;return 1==t?i+1>e.getChildAt(r-1).itemIndex&&(e.scrollV+=this._itemHeight):0==i?e.scrollV=0:e.scrollV>0&&i-1<e.getChildAt(0).itemIndex&&(e.scrollV-=this._itemHeight),this.rawdata[i]},e.prototype.onComplete=function(t){this.itemListContainer&&(this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this.refreshList(),this.itemListContainer.selectedIndex=0,this.itemListContainer.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemSelected,this),this.itemListContainer.useVirtualLayout=!0)},e.prototype.refreshList=function(){var t=this.itemListContainer;if(t){switch(this.collectdata=new eui.ArrayCollection(this.rawdata),t.dataProvider=this.collectdata,this._ty){case PanelType.SHOP_BUY:t.itemRenderer=ItemListBuyObj;break;case PanelType.SHOP_SELL:t.itemRenderer=ItemListSellObj;break;default:t.itemRenderer=ItemListObj}t.selectedIndex=0}},e.prototype.refreshItem=function(t){this.collectdata&&this.collectdata.refresh()},e.prototype.onItemSelected=function(t){var i=this.itemListContainer.selectedItem,n=new egret.Event(e.ITEM_SELECTED);n.data=i,this.dispatchEvent(n)},e.ITEM_SELECTED="ITEM_SELECTED",e}(eui.Component);__reflect(ItemList.prototype,"ItemList");var ItemListObj=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!0,e.skinName="resource/eui_skins/itemListObj.exml",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.tex=IconGenerator.getIconTexture(this.data.tex),this.itemIcon.texture=this.tex},e}(eui.ItemRenderer);__reflect(ItemListObj.prototype,"ItemListObj");var ItemListBuyObj=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.txtNum.text=this.data.item.valueBuy+"G"},e}(ItemListObj);__reflect(ItemListBuyObj.prototype,"ItemListBuyObj");var ItemListSellObj=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.txtNum.text=this.data.item.valueSell+"G"},e}(ItemListObj);__reflect(ItemListSellObj.prototype,"ItemListSellObj");var ItemOpPanel=function(t){function e(e,i){var n=t.call(this)||this;return n._bag=e,n._ty=i,n.addEventListener(eui.UIEvent.ADDED_TO_STAGE,n.onAdded,n),n.skinName="resource/eui_skins/itemOpBtnPanel.exml",n}return __extends(e,t),e.prototype.setItem=function(t){if(this._item=t,null==t)return this.btnLeft.visible=!1,void(this.btnRight.visible=!1);switch(this._ty){case PanelType.BACKBAG:this.btnLeft.visible=t.discardable,this.btnRight.visible=t.useable;break;case PanelType.SHOP_SELL:this.btnLeft.visible=t.discardable;break;case PanelType.SHOP_BUY:this.btnLeft.visible=!1,this.btnRight.visible=!0;break;case PanelType.ALCHMIST:this.btnLeft.visible=!0,this.btnRight.visible=!0}},e.prototype.onAdded=function(t){var e=this.btnLeft,i=this.btnRight;switch(this._ty){case PanelType.BACKBAG:e.visible=!0,e.label="丢弃",i.visible=!0,i.label="使用";break;case PanelType.SHOP_BUY:e.visible=!1,i.visible=!0,i.label="购买";break;case PanelType.SHOP_SELL:i.visible=!1,e.visible=!0,e.label="售卖";break;case PanelType.ALCHMIST:e.visible=!0,e.label="拿出",i.visible=!0,i.label="放入"}this.removeEventListener(eui.UIEvent.ADDED_TO_STAGE,this.onAdded,this),this.btnRight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rightBtnHandler,this),this.btnLeft.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leftBtnHandler,this)},e.prototype.dispose=function(){this.btnRight.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.rightBtnHandler,this),this.btnLeft.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.leftBtnHandler,this)},e.prototype.rightBtnHandler=function(t){},e.prototype.leftBtnHandler=function(t){this._bag.discard(this._item.item)},e.ITEM_USE="ITEM_USE",e.ITEM_DISCARD="ITEM_DISCARD",e}(eui.Component);__reflect(ItemOpPanel.prototype,"ItemOpPanel");var PanelType;!function(t){t[t.BACKBAG=0]="BACKBAG",t[t.SHOP_BUY=1]="SHOP_BUY",t[t.SHOP_SELL=2]="SHOP_SELL",t[t.ALCHMIST=3]="ALCHMIST"}(PanelType||(PanelType={}));var Panel=function(t){function e(e,i,n,r){var a=t.call(this)||this;a._width=n,a._height=r,a._bag=e,a._ty=i,a.touchEnabled=!0,i==PanelType.ALCHMIST?a._allTab=ItemType.LOOT:a._allTab=ItemType.ALL;var s=a.createTabs();s=a.createPanel(s),s=a.createDetail(s),a.createBtns(s),a.createList(),a._shadowFilter=new egret.DropShadowFilter(10,45,null,.5),a.filters=[a._shadowFilter],e.addEventListener(Bag.BAG_EVENT_ADD,a.onBagChange,a),e.addEventListener(Bag.BAG_EVENT_DISCARD,a.onBagChange,a);var o=e.filter(a._allTab);return 0!=o.length?(a._detail.setItem(o[0]),a._btns.setItem(o[0])):(a._detail.setItem(null),a._btns.setItem(null)),a._list.setData(o),document.addEventListener("keyup",function(t){a.onKeyUp(t)}),a}return __extends(e,t),e.prototype.createTabs=function(t){void 0===t&&(t=0);var e;switch(this._ty){case PanelType.ALCHMIST:e=[ItemType.ALL,ItemType.MINE,ItemType.PLANT,ItemType.BONE];break;default:e=[ItemType.ALL,ItemType.NORMAL,ItemType.WEAPON,ItemType.ARMOR,ItemType.ACCESSORY,ItemType.LOOT,ItemType.SPECIAL]}for(var i=this._width/e.length,n=[],r=0;r<e.length;r++){var a=void 0;a=this._ty==PanelType.ALCHMIST&&0!=r?new Tab(i,r,ItemType.LOOT,e[r]):new Tab(i,r,e[r]),a.x=r*a.width,a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabSelected,this),this.addChild(a),n.push(a)}return this._tabs=n,this._tabWidth=n[0].width,this._curTab=0,n[0].setSelected(!0),n[0].width},e.prototype.createPanel=function(t){void 0===t&&(t=0);var e=new egret.Sprite;return e.graphics.beginFill(16747520),e.graphics.drawRoundRect(0,t,this._width,this._height-t,50),e.graphics.endFill(),this._panel=e,this.addChild(this._panel),this._height},e.prototype.createDetail=function(t){void 0===t&&(t=0);var e=new ItemDetail;return e.width=this._width,e.y=t+25,this.addChild(e),this._detail=e,e.height+t+25},e.prototype.createBtns=function(t){void 0===t&&(t=0);var e=new ItemOpPanel(this._bag,this._ty);e.width=this._width,e.y=t+15,this.addChild(e),this._btns=e},e.prototype.createList=function(){var t=this._width,e=new ItemList(this._ty);e.width=t,e.height=this._height-this._tabWidth,e.y=this._tabWidth,e.addEventListener(ItemList.ITEM_SELECTED,this.showDetail,this),this.addChild(e),this._list=e},e.prototype.onTabSelected=function(t){var e=t.currentTarget;this.switchTab(e)},e.prototype.switchTab=function(t){var e=this._tabs[this._curTab];if(e!=t){e&&e.setSelected(!1),this._curTab=t.index,t.setSelected(!0);var i=this._bag.filter(t.tyMain==ItemType.ALL?this._allTab:t.tyMain,t.tySub),n=this._list.setData(i);if(n){var r=n;this._detail.setItem(r),this._btns.setItem(r)}}},e.prototype.onBagChange=function(t){if(t.data.allDiscarded){var e=this._tabs[this._curTab],i=this._bag.filter(e.tyMain,e.tySub),n=this._list.setData(i);if(n){var r=n;this._detail.setItem(r),this._btns.setItem(r)}}},e.prototype.showDetail=function(t){var e=t.data;this._curBobj=e,this._detail.setItem(e),this._btns.setItem(e)},e.prototype.dispose=function(){for(var t=0,e=this._tabs;t<e.length;t++){var i=e[t];i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabSelected,this)}this._bag.removeEventListener(Bag.BAG_EVENT_ADD,this.onBagChange,this),this._bag.removeEventListener(Bag.BAG_EVENT_DISCARD,this.onBagChange,this)},e.prototype.onKeyUp=function(t){var e=37,i=38,n=39,r=40;switch(t.keyCode){case i:var a=this._list.selectItem(-1);a&&(this._detail.setItem(a),this._btns.setItem(a));break;case r:var a=this._list.selectItem(1);a&&(this._detail.setItem(a),this._btns.setItem(a));break;case n:var s=this._curTab+1;s>=this._tabs.length&&(s=0),this.switchTab(this._tabs[s]);break;case e:var s=this._curTab-1;0>s&&(s=this._tabs.length-1),this.switchTab(this._tabs[s])}},e}(egret.Sprite);__reflect(Panel.prototype,"Panel");var Tab=function(t){function e(e,i,n,r){void 0===r&&(r=null);var a=t.call(this)||this;return a.touchEnabled=!0,a.tyMain=n,a.tySub=r,a.index=i,e=e>120?120:e,a._w=e,a.width=e,a.createIcon(),a.createTab(),a}return __extends(e,t),e.prototype.setSelected=function(t){t!=this.selected&&(this.selected=t,t?this.removeChild(this._mask):this.addChild(this._mask))},e.prototype.createTab=function(){var t=this._w,e=1.5*t;this.graphics.beginFill(16747520),this.graphics.drawRoundRect(0,0,t,e,30),this.graphics.endFill();var i=new egret.Shape;i.graphics.beginFill(0,.5),i.graphics.drawRoundRect(0,0,t,e,30),i.graphics.endFill(),this.addChild(i),this._mask=i},e.prototype.createIcon=function(){var t=IconGenerator.getIconUrl(this.tySub?this.tySub:this.tyMain),e=.8*this._w,i=.1*this._w,n=new egret.Bitmap,r=RES.getRes(t);n.texture=r,n.x=i,n.y=i,n.width=e,n.height=e,this.addChild(n)},e}(egret.Sprite);__reflect(Tab.prototype,"Tab");var ItemType;!function(t){t[t.ALL=0]="ALL",t[t.NORMAL=1]="NORMAL",t[t.WEAPON=2]="WEAPON",t[t.ARMOR=3]="ARMOR",t[t.ACCESSORY=4]="ACCESSORY",t[t.LOOT=5]="LOOT",t[t.SPECIAL=6]="SPECIAL",t[t.RECOVER=7]="RECOVER",t[t.BATTLE=8]="BATTLE",t[t.SWORD=9]="SWORD",t[t.CLAYMORE=10]="CLAYMORE",t[t.SPEAR=11]="SPEAR",t[t.BOW=12]="BOW",t[t.ROD=13]="ROD",t[t.HELMET=14]="HELMET",t[t.ARMOR2=15]="ARMOR2",t[t.RING=16]="RING",t[t.MINE=17]="MINE",t[t.PLANT=18]="PLANT",t[t.BONE=19]="BONE",t[t.KEY=20]="KEY",t[t.RECIPE=21]="RECIPE"}(ItemType||(ItemType={}));var BackBag=function(){function t(){}return t.init=function(t,e){var i=this;RES.loadConfig("resource/bag.res.json","resource/").then(function(){return RES.loadGroup("backbag",0)}).then(function(){var n=new eui.Theme("resource/bag.thm.json",t);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},i)})},t.RES_LOADED="RES_LOADED",t}();__reflect(BackBag.prototype,"BackBag");var IronRing=function(t){function e(){var e=t.call(this,null)||this;return e.name="铁指环",e.descript="铁制指环，稍微增加佩戴者的力量",e.tyMain=ItemType.ACCESSORY,e.tySub=ItemType.RING,e}return __extends(e,t),e}(Item);__reflect(IronRing.prototype,"IronRing");var Bag=function(t){function e(){var e=t.call(this)||this;return e.arr=[],e.obj={},e}return __extends(e,t),e.prototype.filter=function(t,e){if(void 0===e&&(e=null),t==ItemType.ALL)return this.arr;var i=this.arr.filter(function(i){return e?i.item.tySub==e:i.item.tyMain==t});return i},e.prototype.add=function(t,i){void 0===i&&(i=1);var n=t.tyMain+"_"+t.tySub,r=new egret.Event(e.BAG_EVENT_ADD);if(this.obj[n])this.obj[n].num+=i;else{var a=new BagObj(t,i);this.obj[n]=a,this.arr.push(a)}r.data=this.obj[n],this.dispatchEvent(r)},e.prototype.discard=function(t,i){void 0===i&&(i=1);var n=t.tyMain+"_"+t.tySub,r=new egret.Event(e.BAG_EVENT_DISCARD),a=this.obj[n];if(a){if(i>a.num&&(i=a.num),a.num-=i,0==a.num){delete this.obj[n];var s=this.arr.indexOf(a);this.arr.splice(s,1)}return r.data={item:a,allDiscarded:0==a.num},this.dispatchEvent(r),a.num}return-1},e.BAG_EVENT_ADD="BAG_EVENT_ADD",e.BAG_EVENT_DISCARD="BAG_EVENT_DISCARD",e}(egret.EventDispatcher);__reflect(Bag.prototype,"Bag");var IronHelmet=function(t){function e(){var e=t.call(this,null)||this;return e.name="铁头盔",e.descript="铁制头盔，能防御住威力较低的攻击",e.tyMain=ItemType.ARMOR,e.tySub=ItemType.HELMET,e}return __extends(e,t),e}(Item);__reflect(IronHelmet.prototype,"IronHelmet");var BendedBone=function(t){function e(){var e=t.call(this,null)||this;return e.name="弯曲的骨头",e.descript="不太坚硬的野兽的骨头",e.tyMain=ItemType.LOOT,e.tySub=ItemType.BONE,e}return __extends(e,t),e}(Item);__reflect(BendedBone.prototype,"BendedBone");var Iron=function(t){function e(){var e=t.call(this,null)||this;return e.name="铁矿石",e.descript="坚硬适中且容易开采的矿石",e.tyMain=ItemType.LOOT,e.tySub=ItemType.MINE,e}return __extends(e,t),e}(Item);__reflect(Iron.prototype,"Iron");var OakLeaf=function(t){function e(){var e=t.call(this,null)||this;return e.name="橡树叶",e.descript="随处可见的树木叶子",e.tyMain=ItemType.LOOT,e.tySub=ItemType.PLANT,e}return __extends(e,t),e}(Item);__reflect(OakLeaf.prototype,"OakLeaf");var Bomb=function(t){function e(){var e=t.call(this,null)||this;return e.name="炸弹",e.descript="造成少量爆炸伤害",e.tyMain=ItemType.NORMAL,e.tySub=ItemType.BATTLE,e}return __extends(e,t),e}(Item);__reflect(Bomb.prototype,"Bomb");var Potion=function(t){function e(){var e=t.call(this,null)||this;return e.name="回复药",e.descript="回复小量生命值",e.tyMain=ItemType.NORMAL,e.tySub=ItemType.RECOVER,e}return __extends(e,t),e}(Item);__reflect(Potion.prototype,"Potion");var DoorKey=function(t){function e(){var e=t.call(this,null)||this;return e.name="钥匙",e.descript="似乎能打开某个地方的锁",e.tyMain=ItemType.SPECIAL,e.tySub=ItemType.KEY,e}return __extends(e,t),e}(Item);__reflect(DoorKey.prototype,"DoorKey");var Recipe=function(t){function e(){var e=t.call(this,null)||this;return e.name="配方",e.descript="记载着合成公式",e.tyMain=ItemType.SPECIAL,e.tySub=ItemType.RECIPE,e}return __extends(e,t),e}(Item);__reflect(Recipe.prototype,"Recipe");var Excalibur=function(t){function e(){var e=t.call(this,null)||this;return e.name="誓约胜利之剑",e.descript="传说中的宝剑",e.tyMain=ItemType.WEAPON,e.tySub=ItemType.CLAYMORE,e.valueBuy=99999,e}return __extends(e,t),e}(Item);__reflect(Excalibur.prototype,"Excalibur");var FireRod=function(t){function e(){var e=t.call(this,null)||this;return e.name="火焰之杖",e.descript="寄宿火之魔力的法杖",e.tyMain=ItemType.WEAPON,e.tySub=ItemType.ROD,e}return __extends(e,t),e}(Item);__reflect(FireRod.prototype,"FireRod");var IronSpear=function(t){function e(){var e=t.call(this,null)||this;return e.name="铁长枪",e.descript="铁制长枪，能贯穿敌人的铠甲",e.tyMain=ItemType.WEAPON,e.tySub=ItemType.SPEAR,e}return __extends(e,t),e}(Item);__reflect(IronSpear.prototype,"IronSpear");var IronSword=function(t){function e(){var e=t.call(this,null)||this;return e.name="铁片手剑",e.descript="铁制短剑，轻盈而容易使用",e.tyMain=ItemType.WEAPON,e.tySub=ItemType.SWORD,e}return __extends(e,t),e}(Item);__reflect(IronSword.prototype,"IronSword");var WoodBow=function(t){function e(){var e=t.call(this,null)||this;return e.name="木弓",e.descript="简易的木质长弓，有效射程10米左右",e.tyMain=ItemType.WEAPON,e.tySub=ItemType.BOW,e}return __extends(e,t),e}(Item);__reflect(WoodBow.prototype,"WoodBow");